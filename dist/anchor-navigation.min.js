"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},_createClass=function(){function n(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var AnchorNavigation=function(){function n(e,t){_classCallCheck(this,n);this.defaultConfig={navigation_list_elements:"#navigation li",navigation_current_class:["current"],heading_container:"div, section, article",home_anchor:"home",threshold:.5,timeout:250,navigation_onclick_callback:function(n,e){},navigation_onupdate_callback:function(n){}},this.config=n.extend({},this.defaultConfig,{navigation_list_elements:e},t),this.nav_entries=new NavEntries,this.update_nav_entries()}return _createClass(n,[{key:"update_nav_entries",value:function(){var n=this;this.nav_entries=this.find_nav_entries(this.config.navigation_list_elements);var e=void 0;window.addEventListener("scroll",function(){window.clearTimeout(e),e=setTimeout(function(){n.update(n.nav_entries)},n.config.timeout)},!1),this.nav_entries.entries.forEach(function(e){e.anchor_element&&e.anchor_element.addEventListener("click",function(t){n.config.navigation_onclick_callback(e,t),n.nav_entries.set_current_page_class(e.key,n.config.navigation_current_class)})})}},{key:"update",value:function(n){var e=this,t=window.innerHeight*this.config.threshold;n.entries.forEach(function(i){if(i.key){var r=i.heading_container.getBoundingClientRect();void 0!==r.height&&r.height<=t&&(t*=r.height/t-.1),r.top-t<=0&&r.bottom-t>=0&&n.set_current_page_class(i.key,e.config.navigation_current_class)&&e.config.navigation_onupdate_callback(i)}})}},{key:"find_nav_entries",value:function(e){var t=this,i=new NavEntries;return document.querySelectorAll(e).forEach(function(e){var r=e;"A"!==r.tagName&&(r=e.querySelector("a"));var a=r.href.split("#")[1];e.classList.contains(t.config.navigation_current_class)&&(a=t.config.home_anchor,r.href+="#"+t.config.home_anchor);var o=document.querySelector("#"+a),c=n.querySelectorParent(o,t.config.heading_container);c||(c=o),a&&o&&i.add(a,e,r,o,c)}),i}}],[{key:"querySelectorParent",value:function(n,e){for(;n;)if((n=n.parentElement)&&n.matches(e))return n;return!1}},{key:"extend",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];for(var r=1;r<t.length;r++)for(var a in t[r])t[r].hasOwnProperty(a)&&(n.is_dictionary(t[r][a])?t[0][a]=n.extend(t[0][a],t[r][a]):t[0][a]=t[r][a]);return t[0]}},{key:"is_dictionary",value:function(n){return!("object"!==(void 0===n?"undefined":_typeof(n))||null===n||n instanceof Array||n instanceof Date)}},{key:"buildThresholdList",value:function(){for(var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=[0],t=1;t<=n;t++){var i=t/n;e.push(i)}return e}}]),n}(),NavEntries=function(){function n(e){_classCallCheck(this,n),this.entries=[],this.current_key=void 0}return _createClass(n,[{key:"push",value:function(n){n instanceof NavEntry&&this.entries.push(n)}},{key:"add",value:function(n,e,t,i,r){var a=new NavEntry(n,e,t,i,r);this.push(a)}},{key:"find",value:function(n){return this.entries.find(function(e){return e.key===n})}},{key:"set_current_page_class",value:function(n,e){if(this.current_key===n)return!1;Array.isArray(e)||(e=[e]),this.entries.map(function(n){return n.list_element.classList.remove(e)});var t=this.find(n);return!!t&&(t.list_element.classList.add(e),this.current_key=n,!0)}}]),n}(),NavEntry=function n(e,t,i,r,a){_classCallCheck(this,n),this.key=e,this.list_element=t,this.anchor_element=i,this.heading_element=r,this.heading_container=a};"undefined"!=typeof jQuery&&(jQuery.fn.anchorNavigation=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new AnchorNavigation(this.selector?this.selector:this[0],n),this});